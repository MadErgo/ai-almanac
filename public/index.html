<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AIé»„å† (The Dao Almanac) - MVP</title>
  <style>
    :root {
      --bg: #0a0a0b;
      --panel: #111115;
      --panel-2: #0f0f14;
      --text: #e8e8ee;
      --muted: #b6b6c2;
      --gold: #f0c040;
      --gold-2: #f8d366;
      --line: linear-gradient(90deg, var(--gold), #ffe8a0);
      --accent: #2dd4bf;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", Helvetica, Arial, sans-serif;
      background: radial-gradient(1000px 600px at 100% -200px, rgba(240, 192, 64, 0.12), transparent 60%),
        radial-gradient(800px 500px at -200px 100%, rgba(45, 212, 191, 0.1), transparent 60%),
        var(--bg);
      color: var(--text);
      min-height: 100vh;
      animation: breathe 15s ease-in-out infinite;
    }

    @keyframes breathe {
      0%, 100% {
        background: radial-gradient(1000px 600px at 100% -200px, rgba(240, 192, 64, 0.12), transparent 60%),
          radial-gradient(800px 500px at -200px 100%, rgba(45, 212, 191, 0.1), transparent 60%),
          var(--bg);
      }
      50% {
        background: radial-gradient(1000px 600px at 100% -200px, rgba(240, 192, 64, 0.15), transparent 60%),
          radial-gradient(800px 500px at -200px 100%, rgba(45, 212, 191, 0.12), transparent 60%),
          var(--bg);
      }
    }

    header {
      position: sticky;
      top: 0;
      backdrop-filter: saturate(140%) blur(10px);
      background: rgba(10, 10, 11, 0.65);
      z-index: 10;
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    }

    .topbar {
      display: flex;
      align-items: center;
      gap: 12px;
      max-width: 1100px;
      margin: 0 auto;
      padding: 12px 16px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--gold);
      box-shadow: 0 0 16px rgba(240, 192, 64, 0.9), 0 0 32px rgba(240, 192, 64, 0.6);
      animation: pulse 3s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% {
        box-shadow: 0 0 16px rgba(240, 192, 64, 0.9), 0 0 32px rgba(240, 192, 64, 0.6);
        transform: scale(1);
      }
      50% {
        box-shadow: 0 0 24px rgba(240, 192, 64, 1), 0 0 48px rgba(240, 192, 64, 0.8);
        transform: scale(1.1);
      }
    }

    .title {
      font-weight: 700;
      background: linear-gradient(135deg, var(--gold), var(--gold-2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      color: var(--muted);
      font-size: 12px;
    }

    .lang-switch {
      margin-left: auto;
      display: flex;
      gap: 8px;
    }

    .lang-btn {
      background: var(--panel);
      color: var(--muted);
      border: 1px solid rgba(255, 255, 255, 0.12);
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .lang-btn.active {
      color: var(--gold);
      border-color: var(--gold);
      background: rgba(240, 192, 64, 0.1);
    }

    .lang-btn:hover {
      border-color: rgba(255, 255, 255, 0.28);
    }

    .api-config {
      margin-left: 16px;
      font-size: 12px;
    }

    .api-status {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #ef4444;
      display: inline-block;
      margin-right: 4px;
    }

    .api-status.connected {
      background: #22c55e;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }

    .form-section {
      background: linear-gradient(180deg, rgba(240, 192, 64, 0.07), transparent 60%), var(--panel);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 18px;
      padding: 24px;
      margin: 20px 0;
      backdrop-filter: blur(10px);
    }

    .form-group {
      margin: 20px 0;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text);
    }

    .required::after {
      content: " *";
      color: var(--accent);
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 10px;
      color: var(--text);
      font-size: 14px;
      font-family: inherit;
      transition: all 0.3s;
    }

    .form-group input::placeholder {
      color: var(--muted);
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--gold);
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 16px rgba(240, 192, 64, 0.2);
    }

    .radio-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .radio-option input[type="radio"] {
      width: auto;
    }

    .privacy-note {
      background: rgba(45, 212, 191, 0.06);
      border: 1px solid rgba(45, 212, 191, 0.3);
      border-radius: 12px;
      padding: 12px;
      font-size: 13px;
      color: var(--muted);
      margin: 16px 0;
      line-height: 1.6;
    }

    .btn {
      background: var(--panel);
      color: var(--text);
      border: 1px solid rgba(255, 255, 255, 0.12);
      padding: 12px 24px;
      border-radius: 10px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
    }

    .btn:hover:not(:disabled) {
      border-color: var(--gold);
      background: rgba(240, 192, 64, 0.1);
      transform: translateY(-2px);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn.primary {
      background: linear-gradient(135deg, var(--gold), var(--gold-2));
      color: #000;
      border: none;
      font-weight: 600;
    }

    .btn.primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(240, 192, 64, 0.3);
    }

    .result-section {
      background: linear-gradient(180deg, rgba(45, 212, 191, 0.06), transparent 60%), var(--panel);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 18px;
      padding: 32px 24px;
      margin: 20px 0;
      text-align: center;
      backdrop-filter: blur(10px);
      animation: slideIn 0.6s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .result-title {
      font-size: 18px;
      margin-bottom: 8px;
      color: var(--gold);
      font-weight: 600;
    }

    .result-date {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 24px;
    }

    .element-polarity {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 20px 0;
      font-size: 16px;
    }

    .element-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 12px 20px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(240, 192, 64, 0.3);
      border-radius: 12px;
    }

    .element-label {
      color: var(--muted);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .element-value {
      color: var(--gold);
      font-weight: 600;
      font-size: 18px;
    }

    .result-content {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 14px;
      padding: 24px;
      margin: 24px 0;
      text-align: left;
      line-height: 1.8;
    }

    .result-item {
      margin: 16px 0;
    }

    .result-label {
      color: var(--gold);
      font-weight: 600;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 6px;
    }

    .result-value {
      color: var(--text);
      font-size: 15px;
      line-height: 1.7;
    }

    .wisdom-text {
      font-size: 16px;
      font-style: italic;
      color: var(--gold-2);
      margin: 24px 0;
      padding: 16px;
      border-left: 3px solid var(--gold);
      background: rgba(248, 211, 102, 0.05);
      border-radius: 8px;
    }

    .signature {
      font-size: 14px;
      color: var(--muted);
      margin-top: 24px;
      text-align: right;
    }

    .signature-name {
      color: var(--gold);
      font-weight: 600;
    }

    .actions {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 24px;
      flex-wrap: wrap;
    }

    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      color: var(--muted);
    }

    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(240, 192, 64, 0.3);
      border-top: 2px solid var(--gold);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .message {
      padding: 12px;
      border-radius: 10px;
      margin: 16px 0;
      display: flex;
      align-items: center;
      gap: 8px;
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #fca5a5;
    }

    .success {
      background: rgba(45, 212, 191, 0.1);
      border: 1px solid rgba(45, 212, 191, 0.3);
      color: #99f6e4;
    }

    .hidden {
      display: none;
    }

    .social-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .social-btn {
      background: var(--panel-2);
      border: 1px solid rgba(255, 255, 255, 0.08);
      color: var(--text);
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .social-btn:hover {
      border-color: var(--accent);
      background: rgba(45, 212, 191, 0.1);
    }

    footer {
      text-align: center;
      padding: 24px;
      color: var(--muted);
      font-size: 12px;
      margin-top: 40px;
      border-top: 1px solid rgba(255, 255, 255, 0.06);
    }

    @media (max-width: 768px) {
      .topbar {
        flex-wrap: wrap;
      }

      .lang-switch {
        margin-left: 0;
        order: 3;
        width: 100%;
        margin-top: 8px;
      }

      .api-config {
        margin-left: 0;
        order: 4;
        width: 100%;
        margin-top: 8px;
      }

      .form-section,
      .result-section {
        padding: 16px;
      }

      .element-polarity {
        flex-direction: column;
        gap: 12px;
      }

      .actions {
        flex-direction: column;
      }

      .actions .btn {
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <header>
    <div class="topbar">
      <div class="logo">
        <span class="dot"></span>
        <div>
          <div class="title">AIé»„å† / The Dao Almanac</div>
          <div class="subtitle">MVP Â· Your Daily Cosmic Guide</div>
        </div>
      </div>
      <div class="lang-switch">
        <button class="lang-btn active" data-lang="cn" onclick="switchLanguage('cn')">ä¸­æ–‡</button>
        <button class="lang-btn" data-lang="en" onclick="switchLanguage('en')">English</button>
      </div>
      <div class="api-config">
        <span class="api-status" id="apiStatus"></span>
        <span id="apiStatusText">Checking...</span>
      </div>
    </div>
  </header>

  <main class="container">
    <div id="formSection" class="form-section">
      <h2 id="title-input">ç”Ÿæˆä½ çš„é»„å†ç­¾æ–‡</h2>

      <div id="errorMessage" class="message error hidden"></div>
      <div id="successMessage" class="message success hidden"></div>

      <form id="almanacForm" onsubmit="handleSubmit(event)">
        <div class="form-group">
          <label for="name" class="required" id="label-name">å§“å</label>
          <input type="text" id="name" name="name" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" required />
          <small style="color: var(--muted); font-size: 12px; margin-top: 4px; display: block;">ğŸ’¡ ä»…ç”¨äºAIåˆ†æï¼Œä¸ä¼šå…¬å¼€</small>
        </div>

        <div class="form-group">
          <label for="nickname" class="required" id="label-nickname">æ˜µç§°</label>
          <input type="text" id="nickname" name="nickname" placeholder="æ˜µç§°å°†æ˜¾ç¤ºåœ¨ç­¾æ–‡ä¸­" required />
          <small style="color: var(--muted); font-size: 12px; margin-top: 4px; display: block;">âœ¨ å°†æ˜¾ç¤ºåœ¨æ‚¨çš„ç­¾æ–‡ä¸­</small>
        </div>

        <div class="form-group">
          <label for="birthdate" class="required" id="label-birthdate">ç”Ÿæ—¥</label>
          <input type="date" id="birthdate" name="birthdate" required />
        </div>

        <div class="form-group">
          <label for="birthTime" id="label-birthtime">å‡ºç”Ÿæ—¶åˆ»ï¼ˆå¯é€‰ï¼‰</label>
          <select id="birthTime" name="birthTime">
            <option value="">é€‰æ‹©æ—¶é—´æ®µæˆ–ä¸ç¡®å®š</option>
            <option value="dawn">æ¸…æ™¨ (05:00-07:00)</option>
            <option value="morning">ä¸Šåˆ (07:00-11:00)</option>
            <option value="noon">ä¸­åˆ (11:00-13:00)</option>
            <option value="afternoon">ä¸‹åˆ (13:00-17:00)</option>
            <option value="dusk">å‚æ™š (17:00-19:00)</option>
            <option value="night">å¤œé—´ (19:00-05:00)</option>
            <option value="unknown">ä¸ç¡®å®š</option>
          </select>
        </div>

        <div class="form-group">
          <label class="required" id="label-mood">å¿ƒæƒ…çŠ¶æ€</label>
          <div class="radio-group">
            <label class="radio-option">
              <input type="radio" name="mood" value="calm" required />
              <span id="mood-calm">å¹³é™</span>
            </label>
            <label class="radio-option">
              <input type="radio" name="mood" value="anxious" />
              <span id="mood-anxious">ç„¦è™‘</span>
            </label>
            <label class="radio-option">
              <input type="radio" name="mood" value="impulsive" />
              <span id="mood-impulsive">å†²åŠ¨</span>
            </label>
            <label class="radio-option">
              <input type="radio" name="mood" value="focused" />
              <span id="mood-focused">ä¸“æ³¨</span>
            </label>
          </div>
        </div>

        <div class="privacy-note" id="privacy-note">
          ğŸ”’ éšç§æç¤ºï¼šæ‚¨çš„å§“åå’Œç”Ÿæ—¥ä»…ç”¨äºAIå‘½ç†åˆ†æï¼Œç»ä¸ä¼šæ˜¾ç¤ºåœ¨åˆ†äº«å¡ç‰‡ä¸­ã€‚ç­¾æ–‡åªä¼šä»¥"æ˜µç§°"çš„å½¢å¼æ˜¾ç¤ºã€‚
        </div>

        <button type="submit" class="btn primary" id="btn-submit">ç”Ÿæˆç­¾æ–‡</button>
      </form>
    </div>

    <div id="resultSection" class="result-section hidden">
      <h2 id="title-result">ä»Šæ—¥é»„å†</h2>
      <div class="result-date" id="resultDate"></div>

      <div class="element-polarity">
        <div class="element-item">
          <span class="element-label" id="label-element">äº”è¡Œ</span>
          <span class="element-value" id="elementValue">-</span>
        </div>
        <div class="element-item">
          <span class="element-label" id="label-polarity">é˜´é˜³</span>
          <span class="element-value" id="polarityValue">-</span>
        </div>
      </div>

      <div class="result-content">
        <div class="result-item">
          <div class="result-label" id="label-auspicious">å®œ</div>
          <div class="result-value" id="auspiciousValue">-</div>
        </div>

        <div class="result-item">
          <div class="result-label" id="label-avoid">å¿Œ</div>
          <div class="result-value" id="avoidValue">-</div>
        </div>

        <div class="result-item">
          <div class="result-label" id="label-lucky">å¹¸è¿æç¤º</div>
          <div class="result-value" id="luckyValue">-</div>
        </div>

        <div class="wisdom-text" id="wisdomText">-</div>

        <div class="signature">
          â€” For <span class="signature-name" id="signatureName">-</span>
        </div>
      </div>

      <div class="actions">
        <button class="btn" onclick="resetForm()" id="btn-reset">é‡æ–°ç”Ÿæˆ</button>
        <button class="btn" onclick="shareResult()" id="btn-share">åˆ†äº«å¡ç‰‡</button>
      </div>

      <div class="social-buttons" id="shareSuccess" style="display: none;">
        <span style="color: var(--accent); font-size: 13px;">âœ“ å¡ç‰‡å·²å¤åˆ¶åˆ°å‰ªè´´æ¿</span>
      </div>
    </div>
  </main>

  <footer id="footer">
    Â© 2025 The Dao Almanac Â· MVP Â· æ–‡åŒ–ä¸å¿ƒç†å»ºè®®å·¥å…· Â· éåŒ»ç–—/æŠ•èµ„å»ºè®®
  </footer>

  <script>
    // é…ç½®
    const API_BASE_URL = 'https://ai-almanac.vercel.app'; // ä¿®æ”¹ä¸ºä½ çš„APIåœ°å€

    // å¤šè¯­è¨€é…ç½®
    const translations = {
      cn: {
        'title-input': 'ç”Ÿæˆä½ çš„é»„å†ç­¾æ–‡',
        'label-name': 'å§“å',
        'label-nickname': 'æ˜µç§°',
        'label-birthdate': 'ç”Ÿæ—¥',
        'label-birthtime': 'å‡ºç”Ÿæ—¶åˆ»ï¼ˆå¯é€‰ï¼‰',
        'label-mood': 'å¿ƒæƒ…çŠ¶æ€',
        'mood-calm': 'å¹³é™',
        'mood-anxious': 'ç„¦è™‘',
        'mood-impulsive': 'å†²åŠ¨',
        'mood-focused': 'ä¸“æ³¨',
        'privacy-note': 'ğŸ”’ éšç§æç¤ºï¼šæ‚¨çš„å§“åå’Œç”Ÿæ—¥ä»…ç”¨äºAIå‘½ç†åˆ†æï¼Œç»ä¸ä¼šæ˜¾ç¤ºåœ¨åˆ†äº«å¡ç‰‡ä¸­ã€‚ç­¾æ–‡åªä¼šä»¥"æ˜µç§°"çš„å½¢å¼æ˜¾ç¤ºã€‚',
        'btn-submit': 'ç”Ÿæˆç­¾æ–‡',
        'title-result': 'ä»Šæ—¥é»„å†',
        'label-element': 'äº”è¡Œ',
        'label-polarity': 'é˜´é˜³',
        'label-auspicious': 'å®œ',
        'label-avoid': 'å¿Œ',
        'label-lucky': 'å¹¸è¿æç¤º',
        'btn-reset': 'é‡æ–°ç”Ÿæˆ',
        'btn-share': 'åˆ†äº«å¡ç‰‡',
        'footer': 'Â© 2025 The Dao Almanac Â· MVP Â· æ–‡åŒ–ä¸å¿ƒç†å»ºè®®å·¥å…· Â· éåŒ»ç–—/æŠ•èµ„å»ºè®®',
        'loading': 'ç”Ÿæˆä¸­...',
        'error-network': 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥APIæœåŠ¡å™¨',
        'error-required': 'è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹',
        'success-generate': 'âœ“ ç­¾æ–‡å·²ç”Ÿæˆ',
        'api-connected': 'âœ“ APIå·²è¿æ¥',
        'api-disconnected': 'âœ— APIæœªè¿æ¥'
      },
      en: {
        'title-input': 'Generate Your Dao Almanac',
        'label-name': 'Name',
        'label-nickname': 'Nickname',
        'label-birthdate': 'Birth Date',
        'label-birthtime': 'Birth Time (Optional)',
        'label-mood': 'Mood',
        'mood-calm': 'Calm',
        'mood-anxious': 'Anxious',
        'mood-impulsive': 'Impulsive',
        'mood-focused': 'Focused',
        'privacy-note': 'ğŸ”’ Privacy Notice: Your name and birth date are only used for AI divination analysis and will never appear in shared cards. Only your nickname will be displayed.',
        'btn-submit': 'Generate Reading',
        'title-result': "Today's Dao Almanac",
        'label-element': 'Element',
        'label-polarity': 'Polarity',
        'label-auspicious': 'Auspicious',
        'label-avoid': 'Avoid',
        'label-lucky': 'Lucky Tip',
        'btn-reset': 'Generate Again',
        'btn-share': 'Share Card',
        'footer': 'Â© 2025 The Dao Almanac Â· MVP Â· Cultural & Psychology Tool Â· Not Medical/Investment Advice',
        'loading': 'Generating...',
        'error-network': 'Network error. Please check API server.',
        'error-required': 'Please fill all required fields',
        'success-generate': 'âœ“ Reading generated',
        'api-connected': 'âœ“ API Connected',
        'api-disconnected': 'âœ— API Disconnected'
      }
    };

    let currentLanguage = 'cn';
    let apiConnected = false;

    // æ£€æŸ¥APIè¿æ¥
    async function checkApiStatus() {
      try {
        const response = await fetch(`${API_BASE_URL}/api/health`, { timeout: 5000 });
        apiConnected = response.ok;
      } catch (error) {
        apiConnected = false;
      }
      updateApiStatus();
    }

    function updateApiStatus() {
      const status = document.getElementById('apiStatus');
      const text = document.getElementById('apiStatusText');
      const statusKey = apiConnected ? 'api-connected' : 'api-disconnected';

      status.classList.toggle('connected', apiConnected);
      text.textContent = translations[currentLanguage][statusKey];
    }

    function switchLanguage(lang) {
      currentLanguage = lang;
      document.querySelectorAll('[id^="label-"], [id^="title-"], [id^="mood-"], [id^="btn-"], [id^="footer"], [id^="privacy-"]').forEach(el => {
        if (translations[lang][el.id]) {
          el.textContent = translations[lang][el.id];
        }
      });

      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
      });

      updateApiStatus();
    }

    // ç”Ÿæˆç­¾æ–‡
    async function generateAlmanac(formData) {
      showLoading(true);

      try {
        const response = await fetch(`${API_BASE_URL}/api/generate-almanac`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });

        if (!response.ok) {
          throw new Error('API request failed');
        }

        const result = await response.json();
        displayResult(result, formData.nickname);
        showMessage('success', translations[currentLanguage]['success-generate']);
      } catch (error) {
        console.error('Error:', error);
        showMessage('error', translations[currentLanguage]['error-network']);
      } finally {
        showLoading(false);
      }
    }

    function displayResult(data, nickname) {
      const today = new Date();
      const dateStr = currentLanguage === 'cn'
        ? `${today.getFullYear()}å¹´${today.getMonth() + 1}æœˆ${today.getDate()}æ—¥`
        : `${today.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}`;

      document.getElementById('resultDate').textContent = dateStr;
      document.getElementById('elementValue').textContent = data.element;
      document.getElementById('polarityValue').textContent = data.polarity;
      document.getElementById('auspiciousValue').textContent = data.auspicious;
      document.getElementById('avoidValue').textContent = data.avoid;
      document.getElementById('luckyValue').textContent = data.lucky;
      document.getElementById('wisdomText').textContent = data.wisdom;
      document.getElementById('signatureName').textContent = nickname;

      document.getElementById('formSection').classList.add('hidden');
      document.getElementById('resultSection').classList.remove('hidden');

      // ä¿å­˜åˆ°localStorage
      localStorage.setItem('lastAlmanac', JSON.stringify({
        date: new Date().toISOString(),
        data: data,
        nickname: nickname
      }));
    }

    function showLoading(show) {
      const btn = document.getElementById('btn-submit');
      if (show) {
        btn.disabled = true;
        btn.innerHTML = `<span class="loading"><span class="spinner"></span><span>${translations[currentLanguage]['loading']}</span></span>`;
      } else {
        btn.disabled = false;
        btn.textContent = translations[currentLanguage]['btn-submit'];
      }
    }

    function showMessage(type, message) {
      const errorEl = document.getElementById('errorMessage');
      const successEl = document.getElementById('successMessage');

      if (type === 'error') {
        errorEl.textContent = message;
        errorEl.classList.remove('hidden');
        successEl.classList.add('hidden');
      } else {
        successEl.textContent = message;
        successEl.classList.remove('hidden');
        errorEl.classList.add('hidden');
      }

      setTimeout(() => {
        errorEl.classList.add('hidden');
        successEl.classList.add('hidden');
      }, 3000);
    }

    function handleSubmit(event) {
      event.preventDefault();

      if (!apiConnected) {
        showMessage('error', translations[currentLanguage]['error-network']);
        return;
      }

      const formData = {
        name: document.getElementById('name').value,
        nickname: document.getElementById('nickname').value,
        birthdate: document.getElementById('birthdate').value,
        birthTime: document.getElementById('birthTime').value,
        mood: document.querySelector('input[name="mood"]:checked').value,
        language: currentLanguage
      };

      if (!formData.name || !formData.nickname || !formData.birthdate) {
        showMessage('error', translations[currentLanguage]['error-required']);
        return;
      }

      generateAlmanac(formData);
    }

    function resetForm() {
      document.getElementById('almanacForm').reset();
      document.getElementById('formSection').classList.remove('hidden');
      document.getElementById('resultSection').classList.add('hidden');
      document.getElementById('errorMessage').classList.add('hidden');
      document.getElementById('successMessage').classList.add('hidden');
    }

    function shareResult() {
      const today = new Date();
      const dateStr = currentLanguage === 'cn'
        ? `${today.getFullYear()}/${today.getMonth() + 1}/${today.getDate()}`
        : `${today.getFullYear()}/${today.getMonth() + 1}/${today.getDate()}`;

      const shareText = `âœ¨ Today's Dao Almanac â€” ${dateStr}
Element: ${document.getElementById('elementValue').textContent}
Polarity: ${document.getElementById('polarityValue').textContent}

${translations[currentLanguage]['label-auspicious']}: ${document.getElementById('auspiciousValue').textContent}
${translations[currentLanguage]['label-avoid']}: ${document.getElementById('avoidValue').textContent}

${document.getElementById('wisdomText').textContent}
â€” For ${document.getElementById('signatureName').textContent}

ğŸŒ™ ç”Ÿæˆäº The Dao Almanac (ai-almanac.example.com)`;

      navigator.clipboard.writeText(shareText).then(() => {
        const shareSuccessDiv = document.getElementById('shareSuccess');
        shareSuccessDiv.style.display = 'flex';
        setTimeout(() => {
          shareSuccessDiv.style.display = 'none';
        }, 2000);
      }).catch(err => {
        console.error('Copy failed:', err);
      });
    }

    // åˆå§‹åŒ–
    switchLanguage('cn');
    checkApiStatus();

    // å®šæœŸæ£€æŸ¥APIçŠ¶æ€
    setInterval(checkApiStatus, 30000);
  </script>
</body>

</html>
